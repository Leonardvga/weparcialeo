<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¬°Aprende Espa√±ol e Ingl√©s!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
        
        :root {
            --primary: #FF5F6D;
            --primary-gradient: linear-gradient(to right, #FF5F6D, #FFC371);
            --secondary: #6A11CB;
            --secondary-gradient: linear-gradient(to right, #6A11CB, #2575FC);
            --success: #00C9A7;
            --danger: #FF4B91;
            --warning: #FFD166;
            --dark: #2D3748;
            --light: #F7FAFC;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.1'%3E%3Cpath opacity='.5' d='M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z'/%3E%3Cpath d='M6 5V0H5v5H0v1h5v94h1V6h94V5H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .app-container {
            width: 90%;
            max-width: 800px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .header {
            background-image: var(--primary-gradient);
            padding: 25px;
            text-align: center;
            color: white;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
            position: relative;
        }
        
        .card {
            background: var(--light);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background-image: var(--secondary-gradient);
        }
        
        .spanish-phrase {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .input-group {
            margin: 20px 0;
        }
        
        .input-group label {
            display: block;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .input-container {
            position: relative;
            display: flex;
        }
        
        .english-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #E2E8F0;
            border-radius: 10px 0 0 10px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background-color: white;
        }
        
        .english-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255,95,109,0.2);
        }
        
        .mic-button {
            background-color: var(--primary);
            border: none;
            border-radius: 0 10px 10px 0;
            width: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mic-button:hover {
            background-color: #FF4B5F;
        }
        
        .mic-icon {
            width: 24px;
            height: 24px;
            fill: white;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-check {
            background-image: var(--primary-gradient);
            color: white;
            flex: 1;
        }
        
        .btn-check:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,95,109,0.3);
        }
        
        .btn-next {
            background-image: var(--secondary-gradient);
            color: white;
            flex: 1;
        }
        
        .btn-next:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106,17,203,0.3);
        }
        
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .correct {
            background-color: rgba(0,201,167,0.1);
            color: var(--success);
            border-left: 4px solid var(--success);
        }
        
        .incorrect {
            background-color: rgba(255,75,145,0.1);
            color: var(--danger);
            border-left: 4px solid var(--danger);
        }
        
        .encouragement {
            margin-top: 10px;
            font-style: italic;
            color: #4A5568;
            font-weight: normal;
        }
        
        .progress-container {
            position: relative;
            height: 8px;
            background-color: #E2E8F0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-image: var(--primary-gradient);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #4A5568;
            margin-bottom: 5px;
        }
        
        .emoji {
            font-size: 1.5rem;
            margin-right: 10px;
            display: inline-block;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #FFC371;
            top: -10px;
            z-index: 10;
            animation: fall 3s ease-out;
            opacity: 0;
        }
        
        @keyframes fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(200px) rotate(360deg);
                opacity: 0;
            }
        }
        
        .streak-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background-image: var(--secondary-gradient);
            color: white;
            border-radius: 15px;
            padding: 5px 15px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 5px 15px rgba(106,17,203,0.3);
        }
        
        .completion-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .completion-content {
            background-color: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .completion-animation.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .completion-animation.active .completion-content {
            transform: scale(1);
        }
        
        .completion-title {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--secondary);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #4A5568;
        }
        
        .mode-switch {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .mode-switch button {
            padding: 8px 15px;
            border: none;
            background-color: #E2E8F0;
            color: #4A5568;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mode-switch button:first-child {
            border-radius: 5px 0 0 5px;
        }
        
        .mode-switch button:last-child {
            border-radius: 0 5px 5px 0;
        }
        
        .mode-switch button.active {
            background-image: var(--primary-gradient);
            color: white;
        }
        
        .listening-indicator {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            color: var(--primary);
            font-weight: 600;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                opacity: 0.6;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.6;
            }
        }
        
        .voice-waves {
            display: flex;
            align-items: center;
            height: 20px;
        }
        
        .wave {
            width: 3px;
            height: 100%;
            margin: 0 2px;
            border-radius: 2px;
            background-color: var(--primary);
            animation: wave 1s infinite ease-in-out;
        }
        
        .wave:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .wave:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        .wave:nth-child(4) {
            animation-delay: 0.6s;
        }
        
        @keyframes wave {
            0%, 100% {
                height: 30%;
            }
            50% {
                height: 100%;
            }
        }
        
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .spanish-phrase {
                font-size: 1.5rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .card {
                padding: 15px;
            }
            
            .btn {
                padding: 10px 15px;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>¬°Aprende Espa√±ol e Ingl√©s!</h1>
            <p>Practica y mejora tu vocabulario en ambos idiomas</p>
            <div class="streak-badge">
                <span id="streak-count">0</span> üî• Racha
            </div>
        </div>
        
        <div class="content">
            <div class="mode-switch">
                <button id="text-mode-btn" class="active">Modo Texto</button>
                <button id="voice-mode-btn">Modo Voz</button>
            </div>
            
            <div class="progress-text">
                <span>Progreso</span>
                <span id="progress-counter">0/20</span>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
            </div>
            
            <div class="card">
                <div class="spanish-phrase">
                    <span class="emoji" id="phrase-emoji"></span>
                    <span id="spanish-phrase"></span>
                </div>
                
                <div class="input-group">
                    <label id="input-label" for="english-input">Traduce al ingl√©s:</label>
                    <div class="input-container">
                        <input type="text" id="english-input" class="english-input" placeholder="Escribe la traducci√≥n aqu√≠">
                        <button id="mic-button" class="mic-button">
                            <svg class="mic-icon" viewBox="0 0 24 24">
                                <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                                <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                            </svg>
                        </button>
                    </div>
                    <div id="listening-indicator" class="listening-indicator">
                        <span>Escuchando...</span>
                        <div class="voice-waves">
                            <div class="wave"></div>
                            <div class="wave"></div>
                            <div class="wave"></div>
                            <div class="wave"></div>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="check-btn" class="btn btn-check">
                        Comprobar
                    </button>
                    <button id="next-btn" class="btn btn-next" style="display: none;">
                        Siguiente frase
                    </button>
                </div>
                
                <div id="feedback" class="feedback" style="display: none;"></div>
            </div>
        </div>
    </div>
    
    <div id="completion-animation" class="completion-animation">
        <div class="completion-content">
            <h2 class="completion-title">¬°Felicidades! üéâ</h2>
            <p>Has completado todas las frases</p>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="correct-count">0</div>
                    <div class="stat-label">Correctas</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="accuracy-percentage">0%</div>
                    <div class="stat-label">Precisi√≥n</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="final-streak">0</div>
                    <div class="stat-label">Racha</div>
                </div>
            </div>
            
            <button id="restart-btn" class="btn btn-check">
                Volver a empezar
            </button>
        </div>
    </div>
    
    <script>
      // Base de datos de frases ampliada
// Base de datos de frases ampliada
const phrases = [
    { spanish: "¬øA qu√© hora es la reuni√≥n?", english: "What time is the meeting?", emoji: "‚è∞" },
    { spanish: "Necesito hacer una llamada.", english: "I need to make a call.", emoji: "üìû" },
    { spanish: "Olvid√© traer mi paraguas.", english: "I forgot to bring my umbrella.", emoji: "‚òÇÔ∏è" },
    { spanish: "¬øQu√© vamos a cenar hoy?", english: "What are we having for dinner today?", emoji: "üçΩÔ∏è" },
    { spanish: "Me duele la cabeza.", english: "I have a headache.", emoji: "ü§ï" },
    { spanish: "¬øPuedes abrir la ventana?", english: "Can you open the window?", emoji: "ü™ü" },
    { spanish: "¬°Hace mucho fr√≠o hoy!", english: "It‚Äôs very cold today!", emoji: "‚ùÑÔ∏è" },
    { spanish: "Mi internet est√° muy lento.", english: "My internet is very slow.", emoji: "üåê" },
    { spanish: "Tengo que ir al banco.", english: "I have to go to the bank.", emoji: "üè¶" },
    { spanish: "Se me cay√≥ el dinero.", english: "I dropped my money.", emoji: "üí∏" },
    { spanish: "No encuentro mis lentes.", english: "I can't find my glasses.", emoji: "üëì" },
    { spanish: "La luz se fue.", english: "The power went out.", emoji: "üí°" },
    { spanish: "¬øPuedes bajar el volumen?", english: "Can you turn down the volume?", emoji: "üîä" },
    { spanish: "Se me olvidaron las llaves.", english: "I forgot my keys.", emoji: "üîë" },
    { spanish: "El caf√© est√° demasiado caliente.", english: "The coffee is too hot.", emoji: "‚òï" },
    { spanish: "Necesito gasolina para el auto.", english: "I need gas for the car.", emoji: "‚õΩ" },
    { spanish: "Voy a sacar la basura.", english: "I‚Äôm going to take out the trash.", emoji: "üóëÔ∏è" },
    { spanish: "El ascensor no funciona.", english: "The elevator is not working.", emoji: "üè¢" },
    { spanish: "No tengo se√±al en mi celular.", english: "I have no signal on my phone.", emoji: "üì∂" },
    { spanish: "Hoy es un d√≠a muy ocupado.", english: "Today is a very busy day.", emoji: "üìÖ" },
    
    // Palabras adicionales
    { spanish: "Sombrero", english: "Hat", emoji: "üé©" },
    { spanish: "Bufanda", english: "Scarf", emoji: "üß£" },
    { spanish: "Guantes", english: "Gloves", emoji: "üß§" },
    { spanish: "Calcetines", english: "Socks", emoji: "üß¶" },
    { spanish: "Zapatos", english: "Shoes", emoji: "üëû" },
    { spanish: "Pantalones", english: "Pants", emoji: "üëñ" },
    { spanish: "Camisa", english: "Shirt", emoji: "üëï" },
    { spanish: "Vestido", english: "Dress", emoji: "üëó" },
    { spanish: "Reloj", english: "Watch", emoji: "‚åö" },
    { spanish: "Mochila", english: "Backpack", emoji: "üéí" },
    { spanish: "Llaves", english: "Keys", emoji: "üîë" },
    { spanish: "Tel√©fono", english: "Phone", emoji: "üì±" },
    { spanish: "Gafas de sol", english: "Sunglasses", emoji: "üï∂Ô∏è" },
    { spanish: "Maleta", english: "Suitcase", emoji: "üß≥" },
    { spanish: "Cartera", english: "Wallet", emoji: "üëõ" },
    { spanish: "Cepillo de dientes", english: "Toothbrush", emoji: "ü™•" },
    { spanish: "Espejo", english: "Mirror", emoji: "ü™û" },
    { spanish: "Silla", english: "Chair", emoji: "ü™ë" },
    { spanish: "Escritorio", english: "Desk", emoji: "üè¢" }
];

        // Mensajes de √°nimo para cuando hay errores
        const encouragements = [
            "¬°No te preocupes! Int√©ntalo de nuevo. üí™",
            "¬°Sigue intent√°ndolo! Vas muy bien. üåü",
            "Casi lo tienes, ¬°no te rindas! üëç",
            "Aprender un idioma lleva tiempo, ¬°t√∫ puedes! üß†",
            "El error es parte del aprendizaje. ¬°Contin√∫a! üìö",
            "¬°Cada intento te acerca m√°s al √©xito! üöÄ",
            "La pr√°ctica hace al maestro. ¬°Sigue adelante! üèÜ",
            "¬°Vas por buen camino! Int√©ntalo una vez m√°s. üåà",
            "Recuerda: el error es el mejor maestro. ¬°√Ånimo! üå±",
            "¬°No pasa nada! Intent√©moslo de nuevo. üí´"
        ];

        // Variables globales
        let currentPhrase;
        let currentIndex = 0;
        let correctAnswers = 0;
        let currentStreak = 0;
        let bestStreak = 0;
        let totalAttempted = 0;
        let isVoiceMode = false;
        let isListening = false;
        let recognition;

        // Elementos del DOM
        const spanishPhraseElement = document.getElementById('spanish-phrase');
        const phraseEmojiElement = document.getElementById('phrase-emoji');
        const englishInput = document.getElementById('english-input');
        const checkButton = document.getElementById('check-btn');
        const nextButton = document.getElementById('next-btn');
        const feedbackElement = document.getElementById('feedback');
        const progressBar = document.getElementById('progress-bar');
        const progressCounter = document.getElementById('progress-counter');
        const streakCount = document.getElementById('streak-count');
        const completionAnimation = document.getElementById('completion-animation');
        const correctCountElement = document.getElementById('correct-count');
        const accuracyPercentageElement = document.getElementById('accuracy-percentage');
        const finalStreakElement = document.getElementById('final-streak');
        const restartButton = document.getElementById('restart-btn');
        const micButton = document.getElementById('mic-button');
        const listeningIndicator = document.getElementById('listening-indicator');
        const textModeBtn = document.getElementById('text-mode-btn');
        const voiceModeBtn = document.getElementById('voice-mode-btn');
        const inputLabel = document.getElementById('input-label');

        // Inicializar reconocimiento de voz si est√° disponible
        function initSpeechRecognition() {
            // Verificar si el navegador soporta reconocimiento de voz
            if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US'; // Para detectar ingl√©s
                
                recognition.onstart = function() {
                    isListening = true;
                    listeningIndicator.style.display = 'flex';
                    micButton.style.backgroundColor = '#FF4B5F';
                };
                
                recognition.onend = function() {
                    isListening = false;
                    listeningIndicator.style.display = 'none';
                    micButton.style.backgroundColor = '';
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript.trim().toLowerCase();
                    englishInput.value = transcript;
                    
                    // Autom√°ticamente verificar la respuesta despu√©s de obtener el resultado
                    setTimeout(checkAnswer, 500);
                };
                
                recognition.onerror = function(event) {
                    console.error('Error en reconocimiento de voz:', event.error);
                    isListening = false;
                    listeningIndicator.style.display = 'none';
                    micButton.style.backgroundColor = '';
                    
                    feedbackElement.style.display = 'block';
                    feedbackElement.className = 'feedback incorrect';
                    feedbackElement.innerHTML = "No se pudo reconocer tu voz. Intenta de nuevo o usa el modo texto.";
                };
                
                return true;
            } else {
                alert('Lo sentimos, tu navegador no soporta reconocimiento de voz. Puedes usar el modo texto.');
                voiceModeBtn.disabled = true;
                return false;return false;
            }
        }
        
        // Funci√≥n para iniciar/detener el reconocimiento de voz
        function toggleSpeechRecognition() {
            if (!recognition) {
                initSpeechRecognition();
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }
        
        // Funci√≥n para mostrar una nueva frase
        function showNewPhrase() {
            if (currentIndex >= phrases.length) {
                showCompletionAnimation();
                return;
            }
            
            currentPhrase = phrases[currentIndex];
            spanishPhraseElement.textContent = currentPhrase.spanish;
            phraseEmojiElement.textContent = currentPhrase.emoji;
            englishInput.value = '';
            
            // Actualizar progreso
            updateProgress();
            
            // Ocultar bot√≥n siguiente y feedback
            nextButton.style.display = 'none';
            feedbackElement.style.display = 'none';
            
            // Enfocar el input (excepto en modo voz)
            if (!isVoiceMode) {
                englishInput.focus();
            }
            
            // Escuchar autom√°ticamente en modo voz
            if (isVoiceMode && recognition) {
                setTimeout(() => {
                    toggleSpeechRecognition();
                }, 1000);
            }
        }
        
        // Funci√≥n para verificar la respuesta
        function checkAnswer() {
            if (englishInput.value.trim() === '') {
                feedbackElement.style.display = 'block';
                feedbackElement.className = 'feedback incorrect';
                feedbackElement.innerHTML = 'Por favor, ingresa una respuesta.';
                return;
            }
            
            totalAttempted++;
            const userAnswer = englishInput.value.trim().toLowerCase();
            const correctAnswer = currentPhrase.english.toLowerCase();
            
            // Verificar si la respuesta es correcta (con cierta flexibilidad)
            // Permitimos peque√±os errores como puntuaci√≥n, may√∫sculas, etc.
            const isCorrect = isAnswerCorrect(userAnswer, correctAnswer);
            
            feedbackElement.style.display = 'block';
            
            if (isCorrect) {
                correctAnswers++;
                currentStreak++;
                if (currentStreak > bestStreak) {
                    bestStreak = currentStreak;
                }
                
                // Actualizar el contador de racha
                streakCount.textContent = currentStreak;
                
                feedbackElement.className = 'feedback correct';
                feedbackElement.innerHTML = '¬°Correcto! üéâ';
                
                // Mostrar bot√≥n para siguiente pregunta
                nextButton.style.display = 'flex';
                checkButton.style.display = 'none';
                
                // Mostrar confeti para celebrar
                createConfetti(5);
            } else {
                // Reiniciar racha si hay error
                currentStreak = 0;
                streakCount.textContent = 0;
                
                feedbackElement.className = 'feedback incorrect';
                feedbackElement.innerHTML = `
                    INCORRECTO, SIGUE TU PUEDES.
                `;
                
                // Mostrar bot√≥n para siguiente pregunta
                nextButton.style.display = 'flex';
                checkButton.style.display = 'none';
            }
        }
        
        // Funci√≥n para comparar respuestas con cierta flexibilidad
        function isAnswerCorrect(userAnswer, correctAnswer) {
            // Eliminar puntuaci√≥n y espacios extra
            const cleanUserAnswer = userAnswer.replace(/[.,!?]/g, '').replace(/\s+/g, ' ').trim();
            const cleanCorrectAnswer = correctAnswer.replace(/[.,!?]/g, '').replace(/\s+/g, ' ').trim();
            
            // Verificar coincidencia exacta
            if (cleanUserAnswer === cleanCorrectAnswer) {
                return true;
            }
            
            // Verificar si es muy similar (para tolerar peque√±os errores)
            const similarity = calculateSimilarity(cleanUserAnswer, cleanCorrectAnswer);
            return similarity > 0.85; // 85% de similitud es aceptable
        }
        
        // Funci√≥n para calcular similitud entre dos textos
        function calculateSimilarity(s1, s2) {
            // Implementaci√≥n simple de distancia de Levenshtein
            const track = Array(s2.length + 1).fill(null).map(() => 
                Array(s1.length + 1).fill(null));
                
            for (let i = 0; i <= s1.length; i++) {
                track[0][i] = i;
            }
            
            for (let j = 0; j <= s2.length; j++) {
                track[j][0] = j;
            }
            
            for (let j = 1; j <= s2.length; j++) {
                for (let i = 1; i <= s1.length; i++) {
                    const cost = s1[i - 1] === s2[j - 1] ? 0 : 1;
                    track[j][i] = Math.min(
                        track[j][i - 1] + 1,
                        track[j - 1][i] + 1,
                        track[j - 1][i - 1] + cost
                    );
                }
            }
            
            const distance = track[s2.length][s1.length];
            const maxLength = Math.max(s1.length, s2.length);
            
            return 1 - distance / maxLength;
        }
        
        // Obtener mensaje de √°nimo aleatorio
        function getRandomEncouragement() {
            const randomIndex = Math.floor(Math.random() * encouragements.length);
            return encouragements[randomIndex];
        }
        
        // Funci√≥n para actualizar la barra de progreso
        function updateProgress() {
            const percentage = (currentIndex / phrases.length) * 100;
            progressBar.style.width = percentage + '%';
            progressCounter.textContent = `${currentIndex}/${phrases.length}`;
        }
        
        // Mostrar animaci√≥n de completado
        function showCompletionAnimation() {
            const accuracy = totalAttempted > 0 ? Math.round((correctAnswers / totalAttempted) * 100) : 0;
            
            // Actualizar elementos de estad√≠sticas
            correctCountElement.textContent = correctAnswers;
            accuracyPercentageElement.textContent = accuracy + '%';
            finalStreakElement.textContent = bestStreak;
            
            // Mostrar animaci√≥n
            completionAnimation.classList.add('active');
        }
        
        // Reiniciar el juego
        function restartGame() {
            // Reiniciar variables
            currentIndex = 0;
            correctAnswers = 0;
            currentStreak = 0;
            totalAttempted = 0;
            
            // Actualizar elementos
            streakCount.textContent = 0;
            
            // Ocultar animaci√≥n de completado
            completionAnimation.classList.remove('active');
            
            // Barajar frases para orden aleatorio
            shufflePhrases();
            
            // Mostrar nueva frase
            showNewPhrase();
        }
        
        // Funci√≥n para crear efecto de confeti
        function createConfetti(count) {
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = getRandomColor();
                confetti.style.width = Math.floor(Math.random() * 8 + 5) + 'px';
                confetti.style.height = Math.floor(Math.random() * 8 + 5) + 'px';
                document.body.appendChild(confetti);
                
                // Eliminar confeti despu√©s de la animaci√≥n
                setTimeout(() => {
                    document.body.removeChild(confetti);
                }, 3000);
            }
        }
        
        // Obtener color aleatorio
        function getRandomColor() {
            const colors = ['#FF5F6D', '#FFC371', '#6A11CB', '#2575FC', '#00C9A7', '#FFD166'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // Funci√≥n para barajar frases
        function shufflePhrases() {
            for (let i = phrases.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [phrases[i], phrases[j]] = [phrases[j], phrases[i]];
            }
        }
        
        // Cambiar modo (texto o voz)
        function setVoiceMode(enabled) {
            isVoiceMode = enabled;
            
            if (enabled) {
                if (!initSpeechRecognition()) {
                    return; // Si no se pudo inicializar, salir
                }
                
                voiceModeBtn.classList.add('active');
                textModeBtn.classList.remove('active');
                inputLabel.textContent = 'Di la traducci√≥n:';
                englishInput.placeholder = 'Presiona el micr√≥fono para hablar';
                micButton.style.display = 'flex';
            } else {
                voiceModeBtn.classList.remove('active');
                textModeBtn.classList.add('active');
                inputLabel.textContent = 'Traduce al ingl√©s:';
                englishInput.placeholder = 'Escribe la traducci√≥n aqu√≠';
                micButton.style.display = 'none';
                
                // Detener reconocimiento si est√° activo
                if (isListening && recognition) {
                    recognition.stop();
                }
            }
        }
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar
            shufflePhrases();
            showNewPhrase();
            
            // Bot√≥n para comprobar respuesta
            checkButton.addEventListener('click', checkAnswer);
            
            // Bot√≥n para siguiente frase
            nextButton.addEventListener('click', function() {
                currentIndex++;
                showNewPhrase();
                checkButton.style.display = 'flex';
            });
            
            // Comprobar al presionar Enter
            englishInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    if (nextButton.style.display === 'flex') {
                        // Si el bot√≥n siguiente est√° visible, ir a la siguiente frase
                        nextButton.click();
                    } else {
                        // Si no, comprobar respuesta
                        checkAnswer();
                    }
                }
            });
            
            // Bot√≥n para reiniciar
            restartButton.addEventListener('click', restartGame);
            
            // Bot√≥n de micr√≥fono
            micButton.addEventListener('click', toggleSpeechRecognition);
            
            // Botones de modo
            textModeBtn.addEventListener('click', function() {
                setVoiceMode(false);
            });
            
            voiceModeBtn.addEventListener('click', function() {
                setVoiceMode(true);
            });
        });
    </script>
</body>
</html>
